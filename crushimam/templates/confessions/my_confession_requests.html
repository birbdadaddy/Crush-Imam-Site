{% extends 'crushimam/base.html' %}

{% block content %}
<div class="container">
    <div class="account-wrapper">
        <h1>My Confession Requests</h1>
        
        <!-- Search Bar -->
        <div class="search-container">
            <form method="get" class="search-bar">
                <input type="text" name="q" class="search-input" placeholder="Ftch wla ktb #id..." value="{{ search_query }}">
                <button type="submit" class="search-btn">Ftch</button>
            </form>
            <p class="search-tip">üí° Nasi7a: Sta3ml <strong>#123</strong> bach tftch bsti3mal l ID</p>
        </div>
        
        {% if requests %}
            <div class="requests-list">
                {% for request in requests %}
                    <div class="account-card">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 10px;">
                            <div>
                                <span class="status-badge status-{{ request.status }}">{{ request.get_status_display|upper }}</span>
                            </div>
                            {% if request.status == 'pending' %}
                                <a href="{% url 'cancel_confession_request' request.pk %}" class="btn btn-sm btn-secondary">Ilgha2</a>
                            {% endif %}
                        </div>
                        
                        <p>{{ request.text }}</p>
                        
                        
                        <div class="account-meta">
                            {% if request.anonymous %}
                                <p><em>Had post majhol</em></p>
                            {% else %}
                                <p><em>Had post b ismk</em></p>
                            {% endif %}
                            F: {{ request.submitted_at|date:"F d, Y \a\t H:i" }}
                            <p>ID: #{{ request.id }}</p>
                        </div>
                        
                        {% if request.status == 'rejected' and request.rejection_reason %}
                            <div class="rejection-reason" style="margin-top: 10px; background: #f8d7da; padding: 10px; border-radius: 6px; color: #721c24;">
                                <strong>Sabab rofod:</strong>
                                <p>{{ request.rejection_reason }}</p>
                            </div>
                        {% endif %}
                        
                        {% if request.status == 'approved' %}
                            <div style="margin-top: 10px; background: #d4edda; padding: 10px; border-radius: 6px; color: #155724;">
                                <small>‚úì 9obila f {{ request.reviewed_at|date:"F d, Y" }}</small>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <!-- Pagination -->
            <div class="pagination-wrapper">
                <nav class="pagination">
                    {% if requests.has_previous %}
                        <a href="?page=1" class="page-link first" title="First Page"></a>
                        <a href="?page={{ requests.previous_page_number }}" class="page-link">Previous</a>
                    {% else %}
                        <span class="page-link disabled"></span>
                        <span class="page-link disabled">Previous</span>
                    {% endif %}
                    
                    <span class="page-info">
                        Page {{ requests.number }} of {{ paginator.num_pages }}
                    </span>
                    
                    {% if requests.has_next %}
                        <a href="?page={{ requests.next_page_number }}" class="page-link">Next</a>
                        <a href="?page={{ paginator.num_pages }}" class="page-link last" title="Last Page"></a>
                    {% else %}
                        <span class="page-link disabled">Next</span>
                        <span class="page-link disabled"></span>
                    {% endif %}
                </nav>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üìù</div>
                <h3>Ma kaynch chi talab</h3>
                <p>Ba9i ma 3mlti chi talab dyal chi 3tiraf.</p>
                <a href="{% url 'confession_request' %}" class="btn btn-primary" style="margin-top: 15px;">3ml l3tiraf dyalk lwl</a>
            </div>
        {% endif %}
        
        <div style="margin-top: 20px;">
            <a href="{% url 'confessions_list' %}" class="btn btn-secondary">‚Üê Rojo3</a>
        </div>
    </div>
</div>
{% endblock %}
